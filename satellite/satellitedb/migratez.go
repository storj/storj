// AUTOGENERATED BY migrategen.go
// DO NOT EDIT.

package satellitedb

import "storj.io/storj/private/migrate"

// testMigration returns migration that can be used for testing.
func (db *satelliteDB) testMigration() *migrate.Migration {
	if db.Name() == "spanner" {
		return db.testMigrationSpanner()
	}
	return db.testMigrationPostgres()
}

// testMigrationSpanner returns migration that can be used for testing on Spanner.
func (db *satelliteDB) testMigrationSpanner() *migrate.Migration {
	return &migrate.Migration{
		Table: "versions",
		Steps: []*migrate.Step{
			{
				DB:          &db.migrationDB,
				Description: "Testing setup",
				Version:     308,
				Action: migrate.SQL{`-- AUTOGENERATED BY storj.io/dbx
-- DO NOT EDIT
CREATE TABLE account_freeze_events (
	user_id BYTES(MAX) NOT NULL,
	event INT64 NOT NULL,
	limits JSON,
	days_till_escalation INT64,
	notifications_count INT64 NOT NULL DEFAULT (0),
	created_at TIMESTAMP NOT NULL DEFAULT (current_timestamp)
) PRIMARY KEY ( user_id, event ) ;
CREATE TABLE accounting_rollups (
	node_id BYTES(MAX) NOT NULL,
	start_time TIMESTAMP NOT NULL,
	put_total INT64 NOT NULL,
	get_total INT64 NOT NULL,
	get_audit_total INT64 NOT NULL,
	get_repair_total INT64 NOT NULL,
	put_repair_total INT64 NOT NULL,
	at_rest_total FLOAT64 NOT NULL,
	interval_end_time TIMESTAMP
) PRIMARY KEY ( node_id, start_time ) ;
CREATE TABLE accounting_timestamps (
	name STRING(MAX) NOT NULL,
	value TIMESTAMP NOT NULL
) PRIMARY KEY ( name ) ;
CREATE TABLE billing_balances (
	user_id BYTES(MAX) NOT NULL,
	balance INT64 NOT NULL,
	last_updated TIMESTAMP NOT NULL
) PRIMARY KEY ( user_id ) ;
CREATE SEQUENCE billing_transactions_id OPTIONS (sequence_kind='bit_reversed_positive') ;
CREATE TABLE billing_transactions (
	id INT64 NOT NULL DEFAULT (GET_NEXT_SEQUENCE_VALUE(SEQUENCE billing_transactions_id)),
	user_id BYTES(MAX) NOT NULL,
	amount INT64 NOT NULL,
	currency STRING(MAX) NOT NULL,
	description STRING(MAX) NOT NULL,
	source STRING(MAX) NOT NULL,
	status STRING(MAX) NOT NULL,
	type STRING(MAX) NOT NULL,
	metadata JSON NOT NULL,
	tx_timestamp TIMESTAMP NOT NULL,
	created_at TIMESTAMP NOT NULL
) PRIMARY KEY ( id ) ;
CREATE TABLE bucket_bandwidth_rollups (
	bucket_name BYTES(MAX) NOT NULL,
	project_id BYTES(MAX) NOT NULL,
	interval_start TIMESTAMP NOT NULL,
	interval_seconds INT64 NOT NULL,
	action INT64 NOT NULL,
	product_id INT64,
	inline INT64 NOT NULL,
	allocated INT64 NOT NULL,
	settled INT64 NOT NULL
) PRIMARY KEY ( project_id, bucket_name, interval_start, action ) ;
CREATE TABLE bucket_bandwidth_rollup_archives (
	bucket_name BYTES(MAX) NOT NULL,
	project_id BYTES(MAX) NOT NULL,
	product_id INT64,
	interval_start TIMESTAMP NOT NULL,
	interval_seconds INT64 NOT NULL,
	action INT64 NOT NULL,
	inline INT64 NOT NULL,
	allocated INT64 NOT NULL,
	settled INT64 NOT NULL
) PRIMARY KEY ( bucket_name, project_id, interval_start, action ) ;
CREATE TABLE bucket_storage_tallies (
	bucket_name BYTES(MAX) NOT NULL,
	project_id BYTES(MAX) NOT NULL,
	interval_start TIMESTAMP NOT NULL,
	product_id INT64,
	total_bytes INT64 NOT NULL DEFAULT (0),
	inline INT64 NOT NULL,
	remote INT64 NOT NULL,
	total_segments_count INT64 NOT NULL DEFAULT (0),
	remote_segments_count INT64 NOT NULL,
	inline_segments_count INT64 NOT NULL,
	object_count INT64 NOT NULL,
	metadata_size INT64 NOT NULL
) PRIMARY KEY ( bucket_name, project_id, interval_start ) ;
CREATE TABLE change_histories (
	id BYTES(MAX) NOT NULL,
	admin_email STRING(MAX) NOT NULL,
	user_id BYTES(MAX) NOT NULL,
	project_id BYTES(MAX),
	bucket_name BYTES(MAX),
	item_type STRING(MAX) NOT NULL,
	operation STRING(MAX) NOT NULL,
	reason STRING(MAX) NOT NULL,
	changes JSON NOT NULL,
	timestamp TIMESTAMP NOT NULL DEFAULT (current_timestamp)
) PRIMARY KEY ( id ) ;
CREATE TABLE coinpayments_transactions (
	id STRING(MAX) NOT NULL,
	user_id BYTES(MAX) NOT NULL,
	address STRING(MAX) NOT NULL,
	amount_numeric INT64 NOT NULL,
	received_numeric INT64 NOT NULL,
	status INT64 NOT NULL,
	key STRING(MAX) NOT NULL,
	timeout INT64 NOT NULL,
	created_at TIMESTAMP NOT NULL
) PRIMARY KEY ( id ) ;
CREATE TABLE entitlements (
	scope BYTES(MAX) NOT NULL,
	features JSON NOT NULL DEFAULT (JSON "{}"),
	updated_at TIMESTAMP NOT NULL,
	created_at TIMESTAMP NOT NULL
) PRIMARY KEY ( scope ) ;
CREATE TABLE nodes (
	id BYTES(MAX) NOT NULL,
	address STRING(MAX) NOT NULL DEFAULT (""),
	last_net STRING(MAX) NOT NULL,
	last_ip_port STRING(MAX),
	country_code STRING(MAX),
	protocol INT64 NOT NULL DEFAULT (0),
	email STRING(MAX) NOT NULL,
	wallet STRING(MAX) NOT NULL,
	wallet_features STRING(MAX) NOT NULL DEFAULT (""),
	free_disk INT64 NOT NULL DEFAULT (-1),
	piece_count INT64 NOT NULL DEFAULT (0),
	major INT64 NOT NULL DEFAULT (0),
	minor INT64 NOT NULL DEFAULT (0),
	patch INT64 NOT NULL DEFAULT (0),
	commit_hash STRING(MAX) NOT NULL DEFAULT (""),
	release_timestamp TIMESTAMP NOT NULL DEFAULT ("0001-01-01 00:00:00+00"),
	release BOOL NOT NULL DEFAULT (false),
	latency_90 INT64 NOT NULL DEFAULT (0),
	vetted_at TIMESTAMP,
	created_at TIMESTAMP NOT NULL DEFAULT (current_timestamp),
	updated_at TIMESTAMP NOT NULL DEFAULT (current_timestamp),
	last_contact_success TIMESTAMP NOT NULL DEFAULT (timestamp_seconds(0)),
	last_contact_failure TIMESTAMP NOT NULL DEFAULT (timestamp_seconds(0)),
	disqualified TIMESTAMP,
	disqualification_reason INT64,
	unknown_audit_suspended TIMESTAMP,
	offline_suspended TIMESTAMP,
	under_review TIMESTAMP,
	exit_initiated_at TIMESTAMP,
	exit_loop_completed_at TIMESTAMP,
	exit_finished_at TIMESTAMP,
	exit_success BOOL NOT NULL DEFAULT (false),
	contained TIMESTAMP,
	last_offline_email TIMESTAMP,
	last_software_update_email TIMESTAMP,
	noise_proto INT64,
	noise_public_key BYTES(MAX),
	debounce_limit INT64 NOT NULL DEFAULT (0),
	features INT64 NOT NULL DEFAULT (0)
) PRIMARY KEY ( id ) ;
CREATE TABLE node_api_versions (
	id BYTES(MAX) NOT NULL,
	api_version INT64 NOT NULL,
	created_at TIMESTAMP NOT NULL,
	updated_at TIMESTAMP NOT NULL
) PRIMARY KEY ( id ) ;
CREATE TABLE node_events (
	id BYTES(MAX) NOT NULL,
	email STRING(MAX) NOT NULL,
	last_ip_port STRING(MAX),
	node_id BYTES(MAX) NOT NULL,
	event INT64 NOT NULL,
	created_at TIMESTAMP NOT NULL DEFAULT (current_timestamp),
	last_attempted TIMESTAMP,
	email_sent TIMESTAMP
) PRIMARY KEY ( id ) ;
CREATE TABLE node_tags (
	node_id BYTES(MAX) NOT NULL,
	name STRING(MAX) NOT NULL,
	value BYTES(MAX) NOT NULL,
	signed_at TIMESTAMP NOT NULL,
	signer BYTES(MAX) NOT NULL
) PRIMARY KEY ( node_id, name, signer ) ;
CREATE TABLE oauth_clients (
	id BYTES(MAX) NOT NULL,
	encrypted_secret BYTES(MAX) NOT NULL,
	redirect_url STRING(MAX) NOT NULL,
	user_id BYTES(MAX) NOT NULL,
	app_name STRING(MAX) NOT NULL,
	app_logo_url STRING(MAX) NOT NULL
) PRIMARY KEY ( id ) ;
CREATE TABLE oauth_codes (
	client_id BYTES(MAX) NOT NULL,
	user_id BYTES(MAX) NOT NULL,
	scope STRING(MAX) NOT NULL,
	redirect_url STRING(MAX) NOT NULL,
	challenge STRING(MAX) NOT NULL,
	challenge_method STRING(MAX) NOT NULL,
	code STRING(MAX) NOT NULL,
	created_at TIMESTAMP NOT NULL,
	expires_at TIMESTAMP NOT NULL,
	claimed_at TIMESTAMP
) PRIMARY KEY ( code ) ;
CREATE TABLE oauth_tokens (
	client_id BYTES(MAX) NOT NULL,
	user_id BYTES(MAX) NOT NULL,
	scope STRING(MAX) NOT NULL,
	kind INT64 NOT NULL,
	token BYTES(MAX) NOT NULL,
	created_at TIMESTAMP NOT NULL,
	expires_at TIMESTAMP NOT NULL
) PRIMARY KEY ( token ) ;
CREATE TABLE peer_identities (
	node_id BYTES(MAX) NOT NULL,
	leaf_serial_number BYTES(MAX) NOT NULL,
	chain BYTES(MAX) NOT NULL,
	updated_at TIMESTAMP NOT NULL
) PRIMARY KEY ( node_id ) ;
CREATE TABLE projects (
	id BYTES(MAX) NOT NULL,
	public_id BYTES(MAX),
	name STRING(MAX) NOT NULL,
	description STRING(MAX) NOT NULL,
	usage_limit INT64,
	bandwidth_limit INT64,
	user_specified_usage_limit INT64,
	user_specified_bandwidth_limit INT64,
	segment_limit INT64 DEFAULT (1000000),
	rate_limit INT64,
	burst_limit INT64,
	rate_limit_head INT64,
	burst_limit_head INT64,
	rate_limit_get INT64,
	burst_limit_get INT64,
	rate_limit_put INT64,
	burst_limit_put INT64,
	rate_limit_list INT64,
	burst_limit_list INT64,
	rate_limit_del INT64,
	burst_limit_del INT64,
	max_buckets INT64,
	user_agent BYTES(MAX),
	owner_id BYTES(MAX) NOT NULL,
	salt BYTES(MAX),
	status INT64 DEFAULT (1),
    status_updated_at TIMESTAMP,
	created_at TIMESTAMP NOT NULL,
	default_placement INT64,
	default_versioning INT64 NOT NULL DEFAULT (1),
	prompted_for_versioning_beta BOOL NOT NULL DEFAULT (false),
	passphrase_enc BYTES(MAX),
	passphrase_enc_key_id INT64,
	path_encryption BOOL NOT NULL DEFAULT (true)
) PRIMARY KEY ( id ) ;
CREATE TABLE project_bandwidth_daily_rollups (
	project_id BYTES(MAX) NOT NULL,
	product_id INT64,
	interval_day DATE NOT NULL,
	egress_allocated INT64 NOT NULL,
	egress_settled INT64 NOT NULL,
	egress_dead INT64 NOT NULL DEFAULT (0)
) PRIMARY KEY ( project_id, interval_day ) ;
CREATE TABLE registration_tokens (
	secret BYTES(MAX) NOT NULL,
	owner_id BYTES(MAX),
	project_limit INT64 NOT NULL,
	created_at TIMESTAMP NOT NULL
) PRIMARY KEY ( secret ) ;
CREATE UNIQUE INDEX index_registration_tokens_owner_id ON registration_tokens ( owner_id ) ;
CREATE TABLE repair_queue (
	stream_id BYTES(MAX) NOT NULL,
	position INT64 NOT NULL,
	attempted_at TIMESTAMP,
	updated_at TIMESTAMP NOT NULL DEFAULT (current_timestamp),
	inserted_at TIMESTAMP NOT NULL DEFAULT (current_timestamp),
	segment_health FLOAT64 NOT NULL DEFAULT (1),
	placement INT64
) PRIMARY KEY ( stream_id, position ) ;
CREATE TABLE reputations (
	id BYTES(MAX) NOT NULL,
	audit_success_count INT64 NOT NULL DEFAULT (0),
	total_audit_count INT64 NOT NULL DEFAULT (0),
	vetted_at TIMESTAMP,
	created_at TIMESTAMP NOT NULL DEFAULT (current_timestamp),
	updated_at TIMESTAMP NOT NULL DEFAULT (current_timestamp),
	disqualified TIMESTAMP,
	disqualification_reason INT64,
	unknown_audit_suspended TIMESTAMP,
	offline_suspended TIMESTAMP,
	under_review TIMESTAMP,
	online_score FLOAT64 NOT NULL DEFAULT (1),
	audit_history BYTES(MAX) NOT NULL,
	audit_reputation_alpha FLOAT64 NOT NULL DEFAULT (1),
	audit_reputation_beta FLOAT64 NOT NULL DEFAULT (0),
	unknown_audit_reputation_alpha FLOAT64 NOT NULL DEFAULT (1),
	unknown_audit_reputation_beta FLOAT64 NOT NULL DEFAULT (0)
) PRIMARY KEY ( id ) ;
CREATE TABLE reset_password_tokens (
	secret BYTES(MAX) NOT NULL,
	owner_id BYTES(MAX) NOT NULL,
	created_at TIMESTAMP NOT NULL
) PRIMARY KEY ( secret ) ;
CREATE UNIQUE INDEX index_reset_password_tokens_owner_id ON reset_password_tokens ( owner_id ) ;
CREATE TABLE reverification_audits (
	node_id BYTES(MAX) NOT NULL,
	stream_id BYTES(MAX) NOT NULL,
	position INT64 NOT NULL,
	piece_num INT64 NOT NULL,
	inserted_at TIMESTAMP NOT NULL DEFAULT (current_timestamp),
	last_attempt TIMESTAMP,
	reverify_count INT64 NOT NULL DEFAULT (0)
) PRIMARY KEY ( node_id, stream_id, position ) ;
CREATE TABLE revocations (
	revoked BYTES(MAX) NOT NULL,
	api_key_id BYTES(MAX) NOT NULL
) PRIMARY KEY ( revoked ) ;
CREATE TABLE segment_pending_audits (
	node_id BYTES(MAX) NOT NULL,
	stream_id BYTES(MAX) NOT NULL,
	position INT64 NOT NULL,
	piece_id BYTES(MAX) NOT NULL,
	stripe_index INT64 NOT NULL,
	share_size INT64 NOT NULL,
	expected_share_hash BYTES(MAX) NOT NULL,
	reverify_count INT64 NOT NULL
) PRIMARY KEY ( node_id ) ;
CREATE TABLE storagenode_bandwidth_rollups (
	storagenode_id BYTES(MAX) NOT NULL,
	interval_start TIMESTAMP NOT NULL,
	interval_seconds INT64 NOT NULL,
	action INT64 NOT NULL,
	allocated INT64 DEFAULT (0),
	settled INT64 NOT NULL
) PRIMARY KEY ( storagenode_id, interval_start, action ) ;
CREATE TABLE storagenode_bandwidth_rollup_archives (
	storagenode_id BYTES(MAX) NOT NULL,
	interval_start TIMESTAMP NOT NULL,
	interval_seconds INT64 NOT NULL,
	action INT64 NOT NULL,
	allocated INT64 DEFAULT (0),
	settled INT64 NOT NULL
) PRIMARY KEY ( storagenode_id, interval_start, action ) ;
CREATE SEQUENCE storagenode_payments_id OPTIONS (sequence_kind='bit_reversed_positive') ;
CREATE TABLE storagenode_payments (
	id INT64 NOT NULL DEFAULT (GET_NEXT_SEQUENCE_VALUE(SEQUENCE storagenode_payments_id)),
	created_at TIMESTAMP NOT NULL,
	node_id BYTES(MAX) NOT NULL,
	period STRING(MAX) NOT NULL,
	amount INT64 NOT NULL,
	receipt STRING(MAX),
	notes STRING(MAX)
) PRIMARY KEY ( id ) ;
CREATE TABLE storagenode_paystubs (
	period STRING(MAX) NOT NULL,
	node_id BYTES(MAX) NOT NULL,
	created_at TIMESTAMP NOT NULL,
	codes STRING(MAX) NOT NULL,
	usage_at_rest FLOAT64 NOT NULL,
	usage_get INT64 NOT NULL,
	usage_put INT64 NOT NULL,
	usage_get_repair INT64 NOT NULL,
	usage_put_repair INT64 NOT NULL,
	usage_get_audit INT64 NOT NULL,
	comp_at_rest INT64 NOT NULL,
	comp_get INT64 NOT NULL,
	comp_put INT64 NOT NULL,
	comp_get_repair INT64 NOT NULL,
	comp_put_repair INT64 NOT NULL,
	comp_get_audit INT64 NOT NULL,
	surge_percent INT64 NOT NULL,
	held INT64 NOT NULL,
	owed INT64 NOT NULL,
	disposed INT64 NOT NULL,
	paid INT64 NOT NULL,
	distributed INT64 NOT NULL
) PRIMARY KEY ( period, node_id ) ;
CREATE TABLE storagenode_storage_tallies (
	node_id BYTES(MAX) NOT NULL,
	interval_end_time TIMESTAMP NOT NULL,
	data_total FLOAT64 NOT NULL
) PRIMARY KEY ( interval_end_time, node_id ) ;
CREATE TABLE storjscan_payments (
	chain_id INT64 NOT NULL DEFAULT (0),
	block_hash BYTES(MAX) NOT NULL,
	block_number INT64 NOT NULL,
	transaction BYTES(MAX) NOT NULL,
	log_index INT64 NOT NULL,
	from_address BYTES(MAX) NOT NULL,
	to_address BYTES(MAX) NOT NULL,
	token_value INT64 NOT NULL,
	usd_value INT64 NOT NULL,
	status STRING(MAX) NOT NULL,
	block_timestamp TIMESTAMP NOT NULL,
	created_at TIMESTAMP NOT NULL
) PRIMARY KEY ( block_hash, log_index ) ;
CREATE TABLE storjscan_wallets (
	user_id BYTES(MAX) NOT NULL,
	wallet_address BYTES(MAX) NOT NULL,
	created_at TIMESTAMP NOT NULL
) PRIMARY KEY ( user_id, wallet_address ) ;
CREATE TABLE stripe_customers (
	user_id BYTES(MAX) NOT NULL,
	customer_id STRING(MAX) NOT NULL,
	billing_customer_id STRING(MAX),
	package_plan STRING(MAX),
	purchased_package_at TIMESTAMP,
	created_at TIMESTAMP NOT NULL
) PRIMARY KEY ( user_id ) ;
CREATE UNIQUE INDEX index_stripe_customers_customer_id ON stripe_customers ( customer_id ) ;
CREATE TABLE stripecoinpayments_invoice_project_records (
	id BYTES(MAX) NOT NULL,
	project_id BYTES(MAX) NOT NULL,
	storage FLOAT64 NOT NULL,
	egress INT64 NOT NULL,
	objects INT64,
	segments INT64,
	period_start TIMESTAMP NOT NULL,
	period_end TIMESTAMP NOT NULL,
	state INT64 NOT NULL,
	created_at TIMESTAMP NOT NULL
) PRIMARY KEY ( id ) ;
CREATE UNIQUE INDEX index_stripecoinpayments_invoice_project_records_project_id_period_start_period_end ON stripecoinpayments_invoice_project_records ( project_id, period_start, period_end ) ;
CREATE TABLE stripecoinpayments_tx_conversion_rates (
	tx_id STRING(MAX) NOT NULL,
	rate_numeric FLOAT64 NOT NULL,
	created_at TIMESTAMP NOT NULL
) PRIMARY KEY ( tx_id ) ;
CREATE TABLE users (
	id BYTES(MAX) NOT NULL,
	external_id STRING(MAX),
    tenant_id STRING(MAX),
    email STRING(MAX) NOT NULL,
	normalized_email STRING(MAX) NOT NULL,
	full_name STRING(MAX) NOT NULL,
	short_name STRING(MAX),
	password_hash BYTES(MAX) NOT NULL,
	new_unverified_email STRING(MAX),
	email_change_verification_step INT64 NOT NULL DEFAULT (0),
	status INT64 NOT NULL,
	status_updated_at TIMESTAMP,
	final_invoice_generated BOOL NOT NULL DEFAULT (false),
	user_agent BYTES(MAX),
	created_at TIMESTAMP NOT NULL,
	project_limit INT64 NOT NULL DEFAULT (0),
	project_bandwidth_limit INT64 NOT NULL DEFAULT (0),
	project_storage_limit INT64 NOT NULL DEFAULT (0),
	project_segment_limit INT64 NOT NULL DEFAULT (0),
	kind INT64 NOT NULL DEFAULT (0),
	position STRING(MAX),
	company_name STRING(MAX),
	company_size INT64,
	working_on STRING(MAX),
	is_professional BOOL NOT NULL DEFAULT (false),
	employee_count STRING(MAX),
	have_sales_contact BOOL NOT NULL DEFAULT (false),
	mfa_enabled BOOL NOT NULL DEFAULT (false),
	mfa_secret_key STRING(MAX),
	mfa_recovery_codes STRING(MAX),
	signup_promo_code STRING(MAX),
	verification_reminders INT64 NOT NULL DEFAULT (0),
	trial_notifications INT64 NOT NULL DEFAULT (0),
	failed_login_count INT64,
	login_lockout_expiration TIMESTAMP,
	signup_captcha FLOAT64,
	default_placement INT64,
	activation_code STRING(MAX),
	signup_id STRING(MAX),
	trial_expiration TIMESTAMP,
	upgrade_time TIMESTAMP,
	hubspot_object_id STRING(MAX)
) PRIMARY KEY ( id ) ;
CREATE TABLE user_settings (
	user_id BYTES(MAX) NOT NULL,
	session_minutes INT64,
	passphrase_prompt BOOL,
	onboarding_start BOOL NOT NULL DEFAULT (true),
	onboarding_end BOOL NOT NULL DEFAULT (true),
	onboarding_step STRING(MAX),
	notice_dismissal JSON NOT NULL DEFAULT (JSON "{}")
) PRIMARY KEY ( user_id ) ;
CREATE TABLE value_attributions (
	project_id BYTES(MAX) NOT NULL,
	bucket_name BYTES(MAX) NOT NULL,
	user_agent BYTES(MAX),
	placement INT64,
	last_updated TIMESTAMP NOT NULL
) PRIMARY KEY ( project_id, bucket_name ) ;
CREATE TABLE verification_audits (
	inserted_at TIMESTAMP NOT NULL DEFAULT (current_timestamp),
	stream_id BYTES(MAX) NOT NULL,
	position INT64 NOT NULL,
	expires_at TIMESTAMP,
	encrypted_size INT64 NOT NULL
) PRIMARY KEY ( inserted_at, stream_id, position ) ;
CREATE TABLE webapp_sessions (
	id BYTES(MAX) NOT NULL,
	user_id BYTES(MAX) NOT NULL,
	ip_address STRING(MAX) NOT NULL,
	user_agent STRING(MAX) NOT NULL,
	status INT64 NOT NULL,
	expires_at TIMESTAMP NOT NULL
) PRIMARY KEY ( id ) ;
CREATE TABLE api_keys (
	id BYTES(MAX) NOT NULL,
	project_id BYTES(MAX) NOT NULL,
	head BYTES(MAX) NOT NULL,
	name STRING(MAX) NOT NULL,
	secret BYTES(MAX) NOT NULL,
	user_agent BYTES(MAX),
	created_at TIMESTAMP NOT NULL,
	created_by BYTES(MAX),
	version INT64 NOT NULL DEFAULT (0),
	CONSTRAINT api_keys_project_id_fkey FOREIGN KEY (project_id) REFERENCES projects (id) ON DELETE CASCADE ,
	CONSTRAINT api_keys_created_by_fkey FOREIGN KEY (created_by) REFERENCES users (id)
) PRIMARY KEY ( id ) ;
CREATE UNIQUE INDEX index_api_keys_head ON api_keys ( head ) ;
CREATE UNIQUE INDEX index_api_keys_name_project_id ON api_keys ( name, project_id ) ;
CREATE TABLE bucket_metainfos (
	id BYTES(MAX) NOT NULL,
	project_id BYTES(MAX) NOT NULL,
	name BYTES(MAX) NOT NULL,
	tags BYTES(MAX),
	user_agent BYTES(MAX),
	versioning INT64 NOT NULL DEFAULT (0),
	object_lock_enabled BOOL NOT NULL DEFAULT (false),
	default_retention_mode INT64,
	default_retention_days INT64,
	default_retention_years INT64,
	path_cipher INT64 NOT NULL,
	created_at TIMESTAMP NOT NULL,
	default_segment_size INT64 NOT NULL,
	default_encryption_cipher_suite INT64 NOT NULL,
	default_encryption_block_size INT64 NOT NULL,
	default_redundancy_algorithm INT64 NOT NULL,
	default_redundancy_share_size INT64 NOT NULL,
	default_redundancy_required_shares INT64 NOT NULL,
	default_redundancy_repair_shares INT64 NOT NULL,
	default_redundancy_optimal_shares INT64 NOT NULL,
	default_redundancy_total_shares INT64 NOT NULL,
	placement INT64,
	created_by BYTES(MAX),
	CONSTRAINT bucket_metainfos_project_id_fkey FOREIGN KEY (project_id) REFERENCES projects (id),
	CONSTRAINT bucket_metainfos_created_by_fkey FOREIGN KEY (created_by) REFERENCES users (id)
) PRIMARY KEY ( project_id, name ) ;
CREATE TABLE bucket_migrations (
	id BYTES(MAX) NOT NULL,
	project_id BYTES(MAX) NOT NULL,
	bucket_name BYTES(MAX) NOT NULL,
	from_placement INT64 NOT NULL,
	to_placement INT64 NOT NULL,
	migration_type INT64 NOT NULL,
	state STRING(MAX) NOT NULL,
	bytes_processed INT64 NOT NULL DEFAULT (0),
	error_message STRING(MAX),
	created_at TIMESTAMP NOT NULL,
	updated_at TIMESTAMP NOT NULL,
	completed_at TIMESTAMP,
	CONSTRAINT bucket_migrations_project_id_fkey FOREIGN KEY (project_id) REFERENCES projects (id)
) PRIMARY KEY ( id ) ;
CREATE TABLE bucket_eventing_configs (
	project_id BYTES(MAX) NOT NULL,
	bucket_name BYTES(MAX) NOT NULL,
	config_id STRING(MAX) NOT NULL DEFAULT (GENERATE_UUID()),
	topic_name STRING(MAX) NOT NULL,
	events ARRAY<STRING(128)> NOT NULL,
	filter_prefix BYTES(1024),
	filter_suffix BYTES(1024),
	created_at TIMESTAMP NOT NULL DEFAULT (CURRENT_TIMESTAMP()),
	updated_at TIMESTAMP NOT NULL OPTIONS (allow_commit_timestamp = TRUE),
	CONSTRAINT bucket_eventing_configs_bucket_fkey
		FOREIGN KEY (project_id, bucket_name)
		REFERENCES bucket_metainfos (project_id, name)
		ON DELETE CASCADE
) PRIMARY KEY ( project_id, bucket_name ) ;
CREATE TABLE domains (
	subdomain STRING(MAX) NOT NULL,
	project_id BYTES(MAX) NOT NULL,
	prefix STRING(MAX) NOT NULL,
	access_id STRING(MAX) NOT NULL,
	created_by BYTES(MAX) NOT NULL,
	created_at TIMESTAMP NOT NULL,
	CONSTRAINT domains_project_id_fkey FOREIGN KEY (project_id) REFERENCES projects (id),
	CONSTRAINT domains_created_by_fkey FOREIGN KEY (created_by) REFERENCES users (id)
) PRIMARY KEY ( project_id, subdomain ) ;
CREATE TABLE project_invitations (
	project_id BYTES(MAX) NOT NULL,
	email STRING(MAX) NOT NULL,
	inviter_id BYTES(MAX),
	created_at TIMESTAMP NOT NULL,
	CONSTRAINT project_invitations_project_id_fkey FOREIGN KEY (project_id) REFERENCES projects (id) ON DELETE CASCADE ,
	CONSTRAINT project_invitations_inviter_id_fkey FOREIGN KEY (inviter_id) REFERENCES users (id) ON DELETE CASCADE
) PRIMARY KEY ( project_id, email ) ;
CREATE TABLE project_members (
	member_id BYTES(MAX) NOT NULL,
	project_id BYTES(MAX) NOT NULL,
	role INT64 NOT NULL DEFAULT (0),
	created_at TIMESTAMP NOT NULL,
	CONSTRAINT project_members_member_id_fkey FOREIGN KEY (member_id) REFERENCES users (id) ON DELETE CASCADE ,
	CONSTRAINT project_members_project_id_fkey FOREIGN KEY (project_id) REFERENCES projects (id) ON DELETE CASCADE
) PRIMARY KEY ( member_id, project_id ) ;
CREATE TABLE rest_api_keys (
	id BYTES(MAX) NOT NULL,
	user_id BYTES(MAX) NOT NULL,
	token BYTES(MAX) NOT NULL,
	name STRING(MAX) NOT NULL,
	expires_at TIMESTAMP,
	created_at TIMESTAMP NOT NULL,
	CONSTRAINT rest_api_keys_user_id_fkey FOREIGN KEY (user_id) REFERENCES users (id) ON DELETE CASCADE
) PRIMARY KEY ( id ) ;
CREATE UNIQUE INDEX index_rest_api_keys_token ON rest_api_keys ( token ) ;
CREATE TABLE stripecoinpayments_apply_balance_intents (
	tx_id STRING(MAX) NOT NULL,
	state INT64 NOT NULL,
	created_at TIMESTAMP NOT NULL,
	CONSTRAINT stripecoinpayments_apply_balance_intents_tx_id_fkey FOREIGN KEY (tx_id) REFERENCES coinpayments_transactions (id) ON DELETE CASCADE
) PRIMARY KEY ( tx_id ) ;
CREATE TABLE api_key_tails (
	root_key_id BYTES(MAX),
	tail BYTES(MAX) NOT NULL,
	parent_tail BYTES(MAX) NOT NULL,
	caveat BYTES(MAX) NOT NULL,
	last_used TIMESTAMP NOT NULL,
	CONSTRAINT api_key_tails_root_key_id_fkey FOREIGN KEY (root_key_id) REFERENCES api_keys (id) ON DELETE CASCADE
) PRIMARY KEY ( tail ) ;
CREATE INDEX accounting_rollups_start_time_index ON accounting_rollups ( start_time ) ;
CREATE INDEX billing_transactions_tx_timestamp_index ON billing_transactions ( tx_timestamp ) ;
CREATE INDEX bucket_bandwidth_rollups_project_id_action_interval_index ON bucket_bandwidth_rollups ( project_id, action, interval_start ) ;
CREATE INDEX bucket_bandwidth_rollups_action_interval_project_id_index ON bucket_bandwidth_rollups ( action, interval_start, project_id ) ;
CREATE INDEX bucket_bandwidth_rollups_archive_project_id_action_interval_index ON bucket_bandwidth_rollup_archives ( project_id, action, interval_start ) ;
CREATE INDEX bucket_bandwidth_rollups_archive_action_interval_project_id_index ON bucket_bandwidth_rollup_archives ( action, interval_start, project_id ) ;
CREATE INDEX bucket_storage_tallies_project_id_interval_start_index ON bucket_storage_tallies ( project_id, interval_start ) ;
CREATE INDEX bucket_storage_tallies_interval_start_index ON bucket_storage_tallies ( interval_start ) ;
CREATE INDEX change_history_user_id_timestamp_idx ON change_histories ( user_id, timestamp ) ;
CREATE INDEX change_history_user_id_item_type_timestamp_idx ON change_histories ( user_id, item_type, timestamp ) ;
CREATE INDEX change_history_project_id_item_type_timestamp_idx ON change_histories ( project_id, item_type, timestamp ) ;
CREATE INDEX change_history_bucket_name_timestamp_idx ON change_histories ( bucket_name, timestamp ) ;
CREATE INDEX node_events_email_event_created_at_index ON node_events ( email, event, created_at ) ;
CREATE INDEX oauth_clients_user_id_index ON oauth_clients ( user_id ) ;
CREATE INDEX oauth_codes_user_id_index ON oauth_codes ( user_id ) ;
CREATE INDEX oauth_codes_client_id_index ON oauth_codes ( client_id ) ;
CREATE INDEX oauth_tokens_user_id_index ON oauth_tokens ( user_id ) ;
CREATE INDEX oauth_tokens_client_id_index ON oauth_tokens ( client_id ) ;
CREATE INDEX projects_public_id_index ON projects ( public_id ) ;
CREATE INDEX projects_owner_id_index ON projects ( owner_id ) ;
CREATE INDEX projects_status_status_updated_at_index ON projects ( status, status_updated_at ) ;
CREATE INDEX project_bandwidth_daily_rollup_interval_day_index ON project_bandwidth_daily_rollups ( interval_day ) ;
CREATE INDEX repair_queue_updated_at_index ON repair_queue ( updated_at ) ;
CREATE INDEX repair_queue_num_healthy_pieces_attempted_at_index ON repair_queue ( segment_health, attempted_at ) ;
CREATE INDEX repair_queue_placement_index ON repair_queue ( placement ) ;
CREATE INDEX reverification_audits_inserted_at_index ON reverification_audits ( inserted_at ) ;
CREATE INDEX storagenode_bandwidth_rollups_interval_start_index ON storagenode_bandwidth_rollups ( interval_start ) ;
CREATE INDEX storagenode_bandwidth_rollup_archives_interval_start_index ON storagenode_bandwidth_rollup_archives ( interval_start ) ;
CREATE INDEX storagenode_payments_node_id_period_index ON storagenode_payments ( node_id, period ) ;
CREATE INDEX storagenode_paystubs_node_id_index ON storagenode_paystubs ( node_id ) ;
CREATE INDEX storagenode_storage_tallies_node_id_index ON storagenode_storage_tallies ( node_id ) ;
CREATE INDEX storjscan_payments_chain_id_block_number_log_index_index ON storjscan_payments ( chain_id, block_number, log_index ) ;
CREATE INDEX storjscan_wallets_wallet_address_index ON storjscan_wallets ( wallet_address ) ;
CREATE INDEX stripecoinpayments_invoice_project_records_unbilled_project_id_index ON stripecoinpayments_invoice_project_records ( project_id ) ;
CREATE INDEX users_email_status_index ON users ( normalized_email, status ) ;
CREATE INDEX trial_expiration_index ON users ( trial_expiration ) ;
CREATE INDEX users_external_id_index ON users ( external_id ) ;
CREATE INDEX users_status_status_updated_at_index ON users ( status, status_updated_at ) ;
CREATE INDEX webapp_sessions_user_id_index ON webapp_sessions ( user_id ) ;
CREATE INDEX bucket_migrations_state_created_at_index ON bucket_migrations ( state, created_at ) ;
CREATE INDEX project_invitations_project_id_index ON project_invitations ( project_id ) ;
CREATE INDEX project_invitations_email_index ON project_invitations ( email ) ;
CREATE INDEX project_members_project_id_index ON project_members ( project_id ) ;
CREATE INDEX rest_api_keys_user_id_index ON rest_api_keys ( user_id ) ;
CREATE INDEX rest_api_keys_name_index ON rest_api_keys ( name ) ;
CREATE INDEX users_tenant_id_index ON users ( tenant_id ) ;
CREATE INDEX users_normalized_email_tenant_id_status_index ON users ( normalized_email, tenant_id, status ) ;

`},
			},
		},
	}
}

// testMigrationPostgres returns migration that can be used for testing on Postgres.
func (db *satelliteDB) testMigrationPostgres() *migrate.Migration {
	return &migrate.Migration{
		Table: "versions",
		Steps: []*migrate.Step{
			{
				DB:          &db.migrationDB,
				Description: "Testing setup",
				Version:     308,
				Action: migrate.SQL{`-- AUTOGENERATED BY storj.io/dbx
-- DO NOT EDIT
CREATE TABLE account_freeze_events (
	user_id bytea NOT NULL,
	event integer NOT NULL,
	limits jsonb,
	days_till_escalation integer,
	notifications_count integer NOT NULL DEFAULT 0,
	created_at timestamp with time zone NOT NULL DEFAULT current_timestamp,
	PRIMARY KEY ( user_id, event )
) ;
CREATE TABLE accounting_rollups (
	node_id bytea NOT NULL,
	start_time timestamp with time zone NOT NULL,
	put_total bigint NOT NULL,
	get_total bigint NOT NULL,
	get_audit_total bigint NOT NULL,
	get_repair_total bigint NOT NULL,
	put_repair_total bigint NOT NULL,
	at_rest_total double precision NOT NULL,
	interval_end_time timestamp with time zone,
	PRIMARY KEY ( node_id, start_time )
) ;
CREATE TABLE accounting_timestamps (
	name text NOT NULL,
	value timestamp with time zone NOT NULL,
	PRIMARY KEY ( name )
) ;
CREATE TABLE billing_balances (
	user_id bytea NOT NULL,
	balance bigint NOT NULL,
	last_updated timestamp with time zone NOT NULL,
	PRIMARY KEY ( user_id )
) ;
CREATE TABLE billing_transactions (
	id bigserial NOT NULL,
	user_id bytea NOT NULL,
	amount bigint NOT NULL,
	currency text NOT NULL,
	description text NOT NULL,
	source text NOT NULL,
	status text NOT NULL,
	type text NOT NULL,
	metadata jsonb NOT NULL,
	tx_timestamp timestamp with time zone NOT NULL,
	created_at timestamp with time zone NOT NULL,
	PRIMARY KEY ( id )
) ;
CREATE TABLE bucket_bandwidth_rollups (
	bucket_name bytea NOT NULL,
	project_id bytea NOT NULL,
	interval_start timestamp with time zone NOT NULL,
	interval_seconds integer NOT NULL,
	action integer NOT NULL,
	product_id integer,
	inline bigint NOT NULL,
	allocated bigint NOT NULL,
	settled bigint NOT NULL,
	PRIMARY KEY ( project_id, bucket_name, interval_start, action )
) ;
CREATE TABLE bucket_bandwidth_rollup_archives (
	bucket_name bytea NOT NULL,
	project_id bytea NOT NULL,
	product_id integer,
	interval_start timestamp with time zone NOT NULL,
	interval_seconds integer NOT NULL,
	action integer NOT NULL,
	inline bigint NOT NULL,
	allocated bigint NOT NULL,
	settled bigint NOT NULL,
	PRIMARY KEY ( bucket_name, project_id, interval_start, action )
) ;
CREATE TABLE bucket_storage_tallies (
	bucket_name bytea NOT NULL,
	project_id bytea NOT NULL,
	interval_start timestamp with time zone NOT NULL,
	product_id integer,
	total_bytes bigint NOT NULL DEFAULT 0,
	inline bigint NOT NULL,
	remote bigint NOT NULL,
	total_segments_count integer NOT NULL DEFAULT 0,
	remote_segments_count integer NOT NULL,
	inline_segments_count integer NOT NULL,
	object_count integer NOT NULL,
	metadata_size bigint NOT NULL,
	PRIMARY KEY ( bucket_name, project_id, interval_start )
) ;
CREATE TABLE change_histories (
	id bytea NOT NULL,
	admin_email text NOT NULL,
	user_id bytea NOT NULL,
	project_id bytea,
	bucket_name bytea,
	item_type text NOT NULL,
	operation text NOT NULL,
	reason text NOT NULL,
	changes jsonb NOT NULL,
	timestamp timestamp with time zone NOT NULL DEFAULT current_timestamp,
	PRIMARY KEY ( id )
) ;
CREATE TABLE coinpayments_transactions (
	id text NOT NULL,
	user_id bytea NOT NULL,
	address text NOT NULL,
	amount_numeric bigint NOT NULL,
	received_numeric bigint NOT NULL,
	status integer NOT NULL,
	key text NOT NULL,
	timeout integer NOT NULL,
	created_at timestamp with time zone NOT NULL,
	PRIMARY KEY ( id )
) ;
CREATE TABLE entitlements (
	scope bytea NOT NULL,
	features jsonb NOT NULL DEFAULT '{}',
	updated_at timestamp with time zone NOT NULL,
	created_at timestamp with time zone NOT NULL,
	PRIMARY KEY ( scope )
) ;
CREATE TABLE nodes (
	id bytea NOT NULL,
	address text NOT NULL DEFAULT '',
	last_net text NOT NULL,
	last_ip_port text,
	country_code text,
	protocol integer NOT NULL DEFAULT 0,
	email text NOT NULL,
	wallet text NOT NULL,
	wallet_features text NOT NULL DEFAULT '',
	free_disk bigint NOT NULL DEFAULT -1,
	piece_count bigint NOT NULL DEFAULT 0,
	major bigint NOT NULL DEFAULT 0,
	minor bigint NOT NULL DEFAULT 0,
	patch bigint NOT NULL DEFAULT 0,
	commit_hash text NOT NULL DEFAULT '',
	release_timestamp timestamp with time zone NOT NULL DEFAULT '0001-01-01 00:00:00+00',
	release boolean NOT NULL DEFAULT false,
	latency_90 bigint NOT NULL DEFAULT 0,
	vetted_at timestamp with time zone,
	created_at timestamp with time zone NOT NULL DEFAULT current_timestamp,
	updated_at timestamp with time zone NOT NULL DEFAULT current_timestamp,
	last_contact_success timestamp with time zone NOT NULL DEFAULT 'epoch',
	last_contact_failure timestamp with time zone NOT NULL DEFAULT 'epoch',
	disqualified timestamp with time zone,
	disqualification_reason integer,
	unknown_audit_suspended timestamp with time zone,
	offline_suspended timestamp with time zone,
	under_review timestamp with time zone,
	exit_initiated_at timestamp with time zone,
	exit_loop_completed_at timestamp with time zone,
	exit_finished_at timestamp with time zone,
	exit_success boolean NOT NULL DEFAULT false,
	contained timestamp with time zone,
	last_offline_email timestamp with time zone,
	last_software_update_email timestamp with time zone,
	noise_proto integer,
	noise_public_key bytea,
	debounce_limit integer NOT NULL DEFAULT 0,
	features integer NOT NULL DEFAULT 0,
	PRIMARY KEY ( id )
) ;
CREATE TABLE node_api_versions (
	id bytea NOT NULL,
	api_version integer NOT NULL,
	created_at timestamp with time zone NOT NULL,
	updated_at timestamp with time zone NOT NULL,
	PRIMARY KEY ( id )
) ;
CREATE TABLE node_events (
	id bytea NOT NULL,
	email text NOT NULL,
	last_ip_port text,
	node_id bytea NOT NULL,
	event integer NOT NULL,
	created_at timestamp with time zone NOT NULL DEFAULT current_timestamp,
	last_attempted timestamp with time zone,
	email_sent timestamp with time zone,
	PRIMARY KEY ( id )
) ;
CREATE TABLE node_tags (
	node_id bytea NOT NULL,
	name text NOT NULL,
	value bytea NOT NULL,
	signed_at timestamp with time zone NOT NULL,
	signer bytea NOT NULL,
	PRIMARY KEY ( node_id, name, signer )
) ;
CREATE TABLE oauth_clients (
	id bytea NOT NULL,
	encrypted_secret bytea NOT NULL,
	redirect_url text NOT NULL,
	user_id bytea NOT NULL,
	app_name text NOT NULL,
	app_logo_url text NOT NULL,
	PRIMARY KEY ( id )
) ;
CREATE TABLE oauth_codes (
	client_id bytea NOT NULL,
	user_id bytea NOT NULL,
	scope text NOT NULL,
	redirect_url text NOT NULL,
	challenge text NOT NULL,
	challenge_method text NOT NULL,
	code text NOT NULL,
	created_at timestamp with time zone NOT NULL,
	expires_at timestamp with time zone NOT NULL,
	claimed_at timestamp with time zone,
	PRIMARY KEY ( code )
) ;
CREATE TABLE oauth_tokens (
	client_id bytea NOT NULL,
	user_id bytea NOT NULL,
	scope text NOT NULL,
	kind integer NOT NULL,
	token bytea NOT NULL,
	created_at timestamp with time zone NOT NULL,
	expires_at timestamp with time zone NOT NULL,
	PRIMARY KEY ( token )
) ;
CREATE TABLE peer_identities (
	node_id bytea NOT NULL,
	leaf_serial_number bytea NOT NULL,
	chain bytea NOT NULL,
	updated_at timestamp with time zone NOT NULL,
	PRIMARY KEY ( node_id )
) ;
CREATE TABLE projects (
	id bytea NOT NULL,
	public_id bytea,
	name text NOT NULL,
	description text NOT NULL,
	usage_limit bigint,
	bandwidth_limit bigint,
	user_specified_usage_limit bigint,
	user_specified_bandwidth_limit bigint,
	segment_limit bigint DEFAULT 1000000,
	rate_limit integer,
	burst_limit integer,
	rate_limit_head integer,
	burst_limit_head integer,
	rate_limit_get integer,
	burst_limit_get integer,
	rate_limit_put integer,
	burst_limit_put integer,
	rate_limit_list integer,
	burst_limit_list integer,
	rate_limit_del integer,
	burst_limit_del integer,
	max_buckets integer,
	user_agent bytea,
	owner_id bytea NOT NULL,
	salt bytea,
	status integer DEFAULT 1,
    status_updated_at timestamp with time zone,
	created_at timestamp with time zone NOT NULL,
	default_placement integer,
	default_versioning integer NOT NULL DEFAULT 1,
	prompted_for_versioning_beta boolean NOT NULL DEFAULT false,
	passphrase_enc bytea,
	passphrase_enc_key_id integer,
	path_encryption boolean NOT NULL DEFAULT true,
	PRIMARY KEY ( id )
) ;
CREATE TABLE project_bandwidth_daily_rollups (
	project_id bytea NOT NULL,
	product_id integer,
	interval_day date NOT NULL,
	egress_allocated bigint NOT NULL,
	egress_settled bigint NOT NULL,
	egress_dead bigint NOT NULL DEFAULT 0,
	PRIMARY KEY ( project_id, interval_day )
) ;
CREATE TABLE registration_tokens (
	secret bytea NOT NULL,
	owner_id bytea,
	project_limit integer NOT NULL,
	created_at timestamp with time zone NOT NULL,
	PRIMARY KEY ( secret ),
	UNIQUE ( owner_id )
) ;
CREATE TABLE repair_queue (
	stream_id bytea NOT NULL,
	position bigint NOT NULL,
	attempted_at timestamp with time zone,
	updated_at timestamp with time zone NOT NULL DEFAULT current_timestamp,
	inserted_at timestamp with time zone NOT NULL DEFAULT current_timestamp,
	segment_health double precision NOT NULL DEFAULT 1,
	placement integer,
	PRIMARY KEY ( stream_id, position )
) ;
CREATE TABLE reputations (
	id bytea NOT NULL,
	audit_success_count bigint NOT NULL DEFAULT 0,
	total_audit_count bigint NOT NULL DEFAULT 0,
	vetted_at timestamp with time zone,
	created_at timestamp with time zone NOT NULL DEFAULT current_timestamp,
	updated_at timestamp with time zone NOT NULL DEFAULT current_timestamp,
	disqualified timestamp with time zone,
	disqualification_reason integer,
	unknown_audit_suspended timestamp with time zone,
	offline_suspended timestamp with time zone,
	under_review timestamp with time zone,
	online_score double precision NOT NULL DEFAULT 1,
	audit_history bytea NOT NULL,
	audit_reputation_alpha double precision NOT NULL DEFAULT 1,
	audit_reputation_beta double precision NOT NULL DEFAULT 0,
	unknown_audit_reputation_alpha double precision NOT NULL DEFAULT 1,
	unknown_audit_reputation_beta double precision NOT NULL DEFAULT 0,
	PRIMARY KEY ( id )
) ;
CREATE TABLE reset_password_tokens (
	secret bytea NOT NULL,
	owner_id bytea NOT NULL,
	created_at timestamp with time zone NOT NULL,
	PRIMARY KEY ( secret ),
	UNIQUE ( owner_id )
) ;
CREATE TABLE reverification_audits (
	node_id bytea NOT NULL,
	stream_id bytea NOT NULL,
	position bigint NOT NULL,
	piece_num integer NOT NULL,
	inserted_at timestamp with time zone NOT NULL DEFAULT current_timestamp,
	last_attempt timestamp with time zone,
	reverify_count bigint NOT NULL DEFAULT 0,
	PRIMARY KEY ( node_id, stream_id, position )
) ;
CREATE TABLE revocations (
	revoked bytea NOT NULL,
	api_key_id bytea NOT NULL,
	PRIMARY KEY ( revoked )
) ;
CREATE TABLE segment_pending_audits (
	node_id bytea NOT NULL,
	stream_id bytea NOT NULL,
	position bigint NOT NULL,
	piece_id bytea NOT NULL,
	stripe_index bigint NOT NULL,
	share_size bigint NOT NULL,
	expected_share_hash bytea NOT NULL,
	reverify_count bigint NOT NULL,
	PRIMARY KEY ( node_id )
) ;
CREATE TABLE storagenode_bandwidth_rollups (
	storagenode_id bytea NOT NULL,
	interval_start timestamp with time zone NOT NULL,
	interval_seconds integer NOT NULL,
	action integer NOT NULL,
	allocated bigint DEFAULT 0,
	settled bigint NOT NULL,
	PRIMARY KEY ( storagenode_id, interval_start, action )
) ;
CREATE TABLE storagenode_bandwidth_rollup_archives (
	storagenode_id bytea NOT NULL,
	interval_start timestamp with time zone NOT NULL,
	interval_seconds integer NOT NULL,
	action integer NOT NULL,
	allocated bigint DEFAULT 0,
	settled bigint NOT NULL,
	PRIMARY KEY ( storagenode_id, interval_start, action )
) ;
CREATE TABLE storagenode_payments (
	id bigserial NOT NULL,
	created_at timestamp with time zone NOT NULL,
	node_id bytea NOT NULL,
	period text NOT NULL,
	amount bigint NOT NULL,
	receipt text,
	notes text,
	PRIMARY KEY ( id )
) ;
CREATE TABLE storagenode_paystubs (
	period text NOT NULL,
	node_id bytea NOT NULL,
	created_at timestamp with time zone NOT NULL,
	codes text NOT NULL,
	usage_at_rest double precision NOT NULL,
	usage_get bigint NOT NULL,
	usage_put bigint NOT NULL,
	usage_get_repair bigint NOT NULL,
	usage_put_repair bigint NOT NULL,
	usage_get_audit bigint NOT NULL,
	comp_at_rest bigint NOT NULL,
	comp_get bigint NOT NULL,
	comp_put bigint NOT NULL,
	comp_get_repair bigint NOT NULL,
	comp_put_repair bigint NOT NULL,
	comp_get_audit bigint NOT NULL,
	surge_percent bigint NOT NULL,
	held bigint NOT NULL,
	owed bigint NOT NULL,
	disposed bigint NOT NULL,
	paid bigint NOT NULL,
	distributed bigint NOT NULL,
	PRIMARY KEY ( period, node_id )
) ;
CREATE TABLE storagenode_storage_tallies (
	node_id bytea NOT NULL,
	interval_end_time timestamp with time zone NOT NULL,
	data_total double precision NOT NULL,
	PRIMARY KEY ( interval_end_time, node_id )
) ;
CREATE TABLE storjscan_payments (
	chain_id bigint NOT NULL DEFAULT 0,
	block_hash bytea NOT NULL,
	block_number bigint NOT NULL,
	transaction bytea NOT NULL,
	log_index integer NOT NULL,
	from_address bytea NOT NULL,
	to_address bytea NOT NULL,
	token_value bigint NOT NULL,
	usd_value bigint NOT NULL,
	status text NOT NULL,
	block_timestamp timestamp with time zone NOT NULL,
	created_at timestamp with time zone NOT NULL,
	PRIMARY KEY ( block_hash, log_index )
) ;
CREATE TABLE storjscan_wallets (
	user_id bytea NOT NULL,
	wallet_address bytea NOT NULL,
	created_at timestamp with time zone NOT NULL,
	PRIMARY KEY ( user_id, wallet_address )
) ;
CREATE TABLE stripe_customers (
	user_id bytea NOT NULL,
	customer_id text NOT NULL,
	billing_customer_id text,
	package_plan text,
	purchased_package_at timestamp with time zone,
	created_at timestamp with time zone NOT NULL,
	PRIMARY KEY ( user_id ),
	UNIQUE ( customer_id )
) ;
CREATE TABLE stripecoinpayments_invoice_project_records (
	id bytea NOT NULL,
	project_id bytea NOT NULL,
	storage double precision NOT NULL,
	egress bigint NOT NULL,
	objects bigint,
	segments bigint,
	period_start timestamp with time zone NOT NULL,
	period_end timestamp with time zone NOT NULL,
	state integer NOT NULL,
	created_at timestamp with time zone NOT NULL,
	PRIMARY KEY ( id ),
	UNIQUE ( project_id, period_start, period_end )
) ;
CREATE TABLE stripecoinpayments_tx_conversion_rates (
	tx_id text NOT NULL,
	rate_numeric double precision NOT NULL,
	created_at timestamp with time zone NOT NULL,
	PRIMARY KEY ( tx_id )
) ;
CREATE TABLE users (
	id bytea NOT NULL,
	external_id text,
	tenant_id text,
	email text NOT NULL,
	normalized_email text NOT NULL,
	full_name text NOT NULL,
	short_name text,
	password_hash bytea NOT NULL,
	new_unverified_email text,
	email_change_verification_step integer NOT NULL DEFAULT 0,
	status integer NOT NULL,
	status_updated_at timestamp with time zone,
	final_invoice_generated boolean NOT NULL DEFAULT false,
	user_agent bytea,
	created_at timestamp with time zone NOT NULL,
	project_limit integer NOT NULL DEFAULT 0,
	project_bandwidth_limit bigint NOT NULL DEFAULT 0,
	project_storage_limit bigint NOT NULL DEFAULT 0,
	project_segment_limit bigint NOT NULL DEFAULT 0,
	kind integer NOT NULL DEFAULT 0,
	position text,
	company_name text,
	company_size integer,
	working_on text,
	is_professional boolean NOT NULL DEFAULT false,
	employee_count text,
	have_sales_contact boolean NOT NULL DEFAULT false,
	mfa_enabled boolean NOT NULL DEFAULT false,
	mfa_secret_key text,
	mfa_recovery_codes text,
	signup_promo_code text,
	verification_reminders integer NOT NULL DEFAULT 0,
	trial_notifications integer NOT NULL DEFAULT 0,
	failed_login_count integer,
	login_lockout_expiration timestamp with time zone,
	signup_captcha double precision,
	default_placement integer,
	activation_code text,
	signup_id text,
	trial_expiration timestamp with time zone,
	upgrade_time timestamp with time zone,
	hubspot_object_id text,
	PRIMARY KEY ( id )
) ;
CREATE TABLE user_settings (
	user_id bytea NOT NULL,
	session_minutes integer,
	passphrase_prompt boolean,
	onboarding_start boolean NOT NULL DEFAULT true,
	onboarding_end boolean NOT NULL DEFAULT true,
	onboarding_step text,
	notice_dismissal jsonb NOT NULL DEFAULT '{}',
	PRIMARY KEY ( user_id )
) ;
CREATE TABLE value_attributions (
	project_id bytea NOT NULL,
	bucket_name bytea NOT NULL,
	user_agent bytea,
	placement integer,
	last_updated timestamp with time zone NOT NULL,
	PRIMARY KEY ( project_id, bucket_name )
) ;
CREATE TABLE verification_audits (
	inserted_at timestamp with time zone NOT NULL DEFAULT current_timestamp,
	stream_id bytea NOT NULL,
	position bigint NOT NULL,
	expires_at timestamp with time zone,
	encrypted_size integer NOT NULL,
	PRIMARY KEY ( inserted_at, stream_id, position )
) ;
CREATE TABLE webapp_sessions (
	id bytea NOT NULL,
	user_id bytea NOT NULL,
	ip_address text NOT NULL,
	user_agent text NOT NULL,
	status integer NOT NULL,
	expires_at timestamp with time zone NOT NULL,
	PRIMARY KEY ( id )
) ;
CREATE TABLE api_keys (
	id bytea NOT NULL,
	project_id bytea NOT NULL REFERENCES projects( id ) ON DELETE CASCADE,
	head bytea NOT NULL,
	name text NOT NULL,
	secret bytea NOT NULL,
	user_agent bytea,
	created_at timestamp with time zone NOT NULL,
	created_by bytea REFERENCES users( id ),
	version integer NOT NULL DEFAULT 0,
	PRIMARY KEY ( id ),
	UNIQUE ( head ),
	UNIQUE ( name, project_id )
) ;
CREATE TABLE bucket_metainfos (
	id bytea NOT NULL,
	project_id bytea NOT NULL REFERENCES projects( id ),
	name bytea NOT NULL,
	tags bytea,
	user_agent bytea,
	versioning integer NOT NULL DEFAULT 0,
	object_lock_enabled boolean NOT NULL DEFAULT false,
	default_retention_mode integer,
	default_retention_days integer,
	default_retention_years integer,
	path_cipher integer NOT NULL,
	created_at timestamp with time zone NOT NULL,
	default_segment_size integer NOT NULL,
	default_encryption_cipher_suite integer NOT NULL,
	default_encryption_block_size integer NOT NULL,
	default_redundancy_algorithm integer NOT NULL,
	default_redundancy_share_size integer NOT NULL,
	default_redundancy_required_shares integer NOT NULL,
	default_redundancy_repair_shares integer NOT NULL,
	default_redundancy_optimal_shares integer NOT NULL,
	default_redundancy_total_shares integer NOT NULL,
	placement integer,
	created_by bytea REFERENCES users( id ),
	PRIMARY KEY ( project_id, name )
) ;
CREATE TABLE bucket_migrations (
	id bytea NOT NULL,
	project_id bytea NOT NULL REFERENCES projects( id ),
	bucket_name bytea NOT NULL,
	from_placement integer NOT NULL,
	to_placement integer NOT NULL,
	migration_type integer NOT NULL,
	state text NOT NULL,
	bytes_processed bigint NOT NULL DEFAULT 0,
	error_message text,
	created_at timestamp with time zone NOT NULL,
	updated_at timestamp with time zone NOT NULL,
	completed_at timestamp with time zone,
	PRIMARY KEY ( id )
) ;
CREATE TABLE bucket_eventing_configs (
	project_id bytea NOT NULL,
	bucket_name bytea NOT NULL,
	config_id text NOT NULL DEFAULT gen_random_uuid()::text,
	topic_name text NOT NULL,
	events text[] NOT NULL,
	filter_prefix bytea,
	filter_suffix bytea,
	created_at timestamp with time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
	updated_at timestamp with time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
	CONSTRAINT bucket_eventing_configs_bucket_fkey
		FOREIGN KEY (project_id, bucket_name)
		REFERENCES bucket_metainfos (project_id, name)
		ON DELETE CASCADE,
	PRIMARY KEY ( project_id, bucket_name )
) ;
CREATE TABLE domains (
	subdomain text NOT NULL,
	project_id bytea NOT NULL REFERENCES projects( id ),
	prefix text NOT NULL,
	access_id text NOT NULL,
	created_by bytea NOT NULL REFERENCES users( id ),
	created_at timestamp with time zone NOT NULL,
	PRIMARY KEY ( project_id, subdomain )
) ;
CREATE TABLE project_invitations (
	project_id bytea NOT NULL REFERENCES projects( id ) ON DELETE CASCADE,
	email text NOT NULL,
	inviter_id bytea REFERENCES users( id ) ON DELETE CASCADE,
	created_at timestamp with time zone NOT NULL,
	PRIMARY KEY ( project_id, email )
) ;
CREATE TABLE project_members (
	member_id bytea NOT NULL REFERENCES users( id ) ON DELETE CASCADE,
	project_id bytea NOT NULL REFERENCES projects( id ) ON DELETE CASCADE,
	role integer NOT NULL DEFAULT 0,
	created_at timestamp with time zone NOT NULL,
	PRIMARY KEY ( member_id, project_id )
) ;
CREATE TABLE rest_api_keys (
	id bytea NOT NULL,
	user_id bytea NOT NULL REFERENCES users( id ) ON DELETE CASCADE,
	token bytea NOT NULL,
	name text NOT NULL,
	expires_at timestamp with time zone,
	created_at timestamp with time zone NOT NULL,
	PRIMARY KEY ( id ),
	UNIQUE ( token )
) ;
CREATE TABLE stripecoinpayments_apply_balance_intents (
	tx_id text NOT NULL REFERENCES coinpayments_transactions( id ) ON DELETE CASCADE,
	state integer NOT NULL,
	created_at timestamp with time zone NOT NULL,
	PRIMARY KEY ( tx_id )
) ;
CREATE TABLE api_key_tails (
	root_key_id bytea REFERENCES api_keys( id ) ON DELETE CASCADE,
	tail bytea NOT NULL,
	parent_tail bytea NOT NULL,
	caveat bytea NOT NULL,
	last_used timestamp with time zone NOT NULL,
	PRIMARY KEY ( tail )
) ;
CREATE INDEX accounting_rollups_start_time_index ON accounting_rollups ( start_time ) ;
CREATE INDEX billing_transactions_tx_timestamp_index ON billing_transactions ( tx_timestamp ) ;
CREATE INDEX bucket_bandwidth_rollups_project_id_action_interval_index ON bucket_bandwidth_rollups ( project_id, action, interval_start ) ;
CREATE INDEX bucket_bandwidth_rollups_action_interval_project_id_index ON bucket_bandwidth_rollups ( action, interval_start, project_id ) ;
CREATE INDEX bucket_bandwidth_rollups_archive_project_id_action_interval_index ON bucket_bandwidth_rollup_archives ( project_id, action, interval_start ) ;
CREATE INDEX bucket_bandwidth_rollups_archive_action_interval_project_id_index ON bucket_bandwidth_rollup_archives ( action, interval_start, project_id ) ;
CREATE INDEX bucket_storage_tallies_project_id_interval_start_index ON bucket_storage_tallies ( project_id, interval_start ) ;
CREATE INDEX bucket_storage_tallies_interval_start_index ON bucket_storage_tallies ( interval_start ) ;
CREATE INDEX change_history_user_id_timestamp_idx ON change_histories ( user_id, timestamp ) ;
CREATE INDEX change_history_user_id_item_type_timestamp_idx ON change_histories ( user_id, item_type, timestamp ) ;
CREATE INDEX change_history_project_id_item_type_timestamp_idx ON change_histories ( project_id, item_type, timestamp ) ;
CREATE INDEX change_history_bucket_name_timestamp_idx ON change_histories ( bucket_name, timestamp ) ;
CREATE INDEX node_events_email_event_created_at_index ON node_events ( email, event, created_at ) WHERE node_events.email_sent is NULL ;
CREATE INDEX oauth_clients_user_id_index ON oauth_clients ( user_id ) ;
CREATE INDEX oauth_codes_user_id_index ON oauth_codes ( user_id ) ;
CREATE INDEX oauth_codes_client_id_index ON oauth_codes ( client_id ) ;
CREATE INDEX oauth_tokens_user_id_index ON oauth_tokens ( user_id ) ;
CREATE INDEX oauth_tokens_client_id_index ON oauth_tokens ( client_id ) ;
CREATE INDEX projects_public_id_index ON projects ( public_id ) ;
CREATE INDEX projects_owner_id_index ON projects ( owner_id ) ;
CREATE INDEX projects_status_status_updated_at_index ON projects ( status, status_updated_at ) WHERE projects.status_updated_at is not NULL ;
CREATE INDEX project_bandwidth_daily_rollup_interval_day_index ON project_bandwidth_daily_rollups ( interval_day ) ;
CREATE INDEX repair_queue_updated_at_index ON repair_queue ( updated_at ) ;
CREATE INDEX repair_queue_num_healthy_pieces_attempted_at_index ON repair_queue ( segment_health, attempted_at ) ;
CREATE INDEX repair_queue_placement_index ON repair_queue ( placement ) ;
CREATE INDEX reverification_audits_inserted_at_index ON reverification_audits ( inserted_at ) ;
CREATE INDEX storagenode_bandwidth_rollups_interval_start_index ON storagenode_bandwidth_rollups ( interval_start ) ;
CREATE INDEX storagenode_bandwidth_rollup_archives_interval_start_index ON storagenode_bandwidth_rollup_archives ( interval_start ) ;
CREATE INDEX storagenode_payments_node_id_period_index ON storagenode_payments ( node_id, period ) ;
CREATE INDEX storagenode_paystubs_node_id_index ON storagenode_paystubs ( node_id ) ;
CREATE INDEX storagenode_storage_tallies_node_id_index ON storagenode_storage_tallies ( node_id ) ;
CREATE INDEX storjscan_payments_chain_id_block_number_log_index_index ON storjscan_payments ( chain_id, block_number, log_index ) ;
CREATE INDEX storjscan_wallets_wallet_address_index ON storjscan_wallets ( wallet_address ) ;
CREATE INDEX stripecoinpayments_invoice_project_records_unbilled_project_id_index ON stripecoinpayments_invoice_project_records ( project_id ) WHERE stripecoinpayments_invoice_project_records.state = 0 ;
CREATE INDEX users_email_status_index ON users ( normalized_email, status ) ;
CREATE INDEX trial_expiration_index ON users ( trial_expiration ) ;
CREATE INDEX users_external_id_index ON users ( external_id ) WHERE users.external_id is not NULL ;
CREATE INDEX users_status_status_updated_at_index ON users ( status, status_updated_at ) WHERE users.status_updated_at is not NULL ;
CREATE INDEX webapp_sessions_user_id_index ON webapp_sessions ( user_id ) ;
CREATE INDEX bucket_migrations_state_created_at_index ON bucket_migrations ( state, created_at ) ;
CREATE INDEX project_invitations_project_id_index ON project_invitations ( project_id ) ;
CREATE INDEX project_invitations_email_index ON project_invitations ( email ) ;
CREATE INDEX project_members_project_id_index ON project_members ( project_id ) ;
CREATE INDEX rest_api_keys_user_id_index ON rest_api_keys ( user_id ) ;
CREATE INDEX rest_api_keys_name_index ON rest_api_keys ( name ) ;
CREATE INDEX users_tenant_id_index ON users ( tenant_id ) WHERE users.tenant_id is not NULL ;
CREATE INDEX users_normalized_email_tenant_id_status_index ON users ( normalized_email, tenant_id, status ) WHERE users.tenant_id is not NULL ;

`},
			},
		},
	}
}
